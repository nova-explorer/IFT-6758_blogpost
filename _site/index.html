<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      IFT6758 Blog A-09 &middot; Data science on NHL data
    
  </title>

  
  <link rel="canonical" href="http://localhost:4000/">
  

  <link rel="stylesheet" href="http://localhost:4000/public/css/poole.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/syntax.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://localhost:4000/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://localhost:4000/atom.xml">

  
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Projet de science des données dans le cadre du cours IFT-6758 de UdeM. Le projet concerne les données de la LNH.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item active" href="http://localhost:4000/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="http://localhost:4000/about/">About</a>
        
      
    
      
    

    <span class="sidebar-nav-item">Currently v1.1.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2023. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">IFT6758 Blog A-09</a>
            <small>Data science on NHL data</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://localhost:4000/2023/10/10/milestone-1/">
        Milestone 1
      </a>
    </h1>

    <span class="post-date">10 Oct 2023</span>

    <h2 id="section-1--acquisition-de-données">Section 1 : Acquisition de données</h2>

<h3 id="question-11">Question 1.1</h3>

<div class="message">
    Rédigez un bref tutoriel sur comment votre équipe a téléchargé l'ensemble de données. Imaginez que vous cherchiez un guide sur comment télécharger les données play-by-play; votre guide devrait vous faire dire "Parfait - c'est exactement ce que je cherchais!". Incluez votre fonction/classe et fournissez un exemple de son utilisation.
</div>

<p>Les données que nous désirons acquérir sont disponibles à partir d’un API utilisant des url telles que :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://statsapi.web.nhl.com/api/v1/game/2017020001/feed/live/
</code></pre></div></div>

<p>où <code class="language-plaintext highlighter-rouge">2017020001</code> correspond au game_id de la partie. Le game_id est composé de trois sections, soit l’année de la saison (2017), le type de saison (02) et le numéro de la partie (0001). Les types de saison nous intéressant sont 02 pour les saisons régulières. Pour obtenir l’entièreté de la saison régulière de 2016, on peut simplement itérer sur le numéro de la partie en utilisant :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">access_point</span> <span class="o">=</span> <span class="s">"https://statsapi.web.nhl.com/api/v1/game/"</span>
<span class="n">season</span> <span class="o">=</span> <span class="mi">2016</span>
<span class="n">game_id</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">game_id_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">season</span><span class="si">}</span><span class="s">02</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">game_id</span><span class="p">).</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s">"</span>
<span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">access_point</span><span class="si">}{</span><span class="n">game_id_str</span><span class="si">}</span><span class="s">/feed/live/"</span>
</code></pre></div></div>

<p>et augmenter game_id. On peut alors définir le nom du fichier où les données seront sauvegardées afin de vérifier s’il existe déjà localement et ne pas le télécharger.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">save_directory</span> <span class="o">=</span> <span class="s">"../NHLGameData"</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_directory</span><span class="p">,</span> <span class="sa">f</span><span class="s">"game_</span><span class="si">{</span><span class="n">game_id_str</span><span class="si">}</span><span class="s">.json"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="c1">#do not download filename and continue to next file
</span>    <span class="n">game_id</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">continue</span>
</code></pre></div></div>

<p>Dans le cas ᴏù nous voulons télécharger le fichier, il nous faudra commencer par vérifier si celui-ci existe dans l’API.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
    <span class="c1"># download file
</span><span class="k">elif</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
    <span class="c1"># Game not found, exit the loop
</span>    <span class="k">break</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error in regular match ID </span><span class="si">{</span><span class="n">game_id_str</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>

<p>Si la partie existe et est accessible, le code renvoyé sera 200. Si la partie n’existe pas (erreur 404), cela veut dire que le game_id présent est devenu trop haut et il est nécessaire de quitter la boucle d’itération de match afin de ne pas faire des demandes inutiles à l’API. Si un autre code est renvoyé, cela n’est pas normal et il est intéressant de le notifier dans l’interface. Finalement, si on veut télécharger le fichier, il est nécessaire de savoir que l’API enregistre ses données en format json. On peut donc accéder aux données pertinentes et les téléchargées dans un fichier.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">playByPlay</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()[</span><span class="s">'liveData'</span><span class="p">][</span><span class="s">'plays'</span><span class="p">][</span><span class="s">'allPlays'</span><span class="p">]</span>
<span class="n">home_team</span> <span class="o">=</span> <span class="n">responses</span><span class="p">.</span><span class="n">json</span><span class="p">()[</span><span class="s">'gameData'</span><span class="p">][</span><span class="s">'teams'</span><span class="p">][</span><span class="s">'home'</span><span class="p">][</span><span class="s">'name'</span><span class="p">]</span>
<span class="n">away_team</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()[</span><span class="s">'gameData'</span><span class="p">][</span><span class="s">'teams'</span><span class="p">][</span><span class="s">'away'</span><span class="p">][</span><span class="s">'name'</span><span class="p">]</span>
<span class="n">periods</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()[</span><span class="s">'liveData'</span><span class="p">][</span><span class="s">'linescore'</span><span class="p">][</span><span class="s">'periods'</span><span class="p">]</span>

<span class="c1"># create and save the json informations into the file
</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">data_to_save</span> <span class="o">=</span> <span class="p">{</span><span class="s">"playByPlay"</span><span class="p">:</span> <span class="n">playByPlay</span><span class="p">,</span><span class="s">"periods"</span><span class="p">:</span> <span class="n">periods</span><span class="p">,</span> <span class="s">"home"</span><span class="p">:</span> <span class="n">home_team</span><span class="p">,</span> <span class="s">"away"</span><span class="p">:</span> <span class="n">away_team</span><span class="p">}</span>
    <span class="n">json</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data_to_save</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="section-2--débogage-interactif">Section 2 : Débogage interactif</h2>

<h3 id="question-21">Question 2.1</h3>

<div class="message">
    Implémentez un ipywidget qui vous permet de parcourir tous les événements, pour chaque match d'une saison donnée, avec la possibilité de changer entre la saison régulière et les séries éliminatoires. Dessinez les coordonnées de l'événement sur l'image de la patinoire fournie, similaire à l'exemple ci-dessous (vous pouvez simplement imprimer les données de l'événement lorsqu'il n'y a pas de coordonnées). Vous pouvez également imprimer toutes les informations que vous jugez utiles, telles que les métadonnées du jeu/boxscores et les résumés des événements (mais ce n'est pas obligatoire). Prenez une capture d'écran de l'outil et ajoutez-la à l’article de blog, accompagnée du code de l'outil et d'une brève description (1-2 phrases) de ce que fait votre outil. Vous n'avez pas à vous soucier de l'intégration de l'outil dans le blogpost.
</div>

<p><img src="/assets/Q2.png" alt="q2_ipywidgets" /></p>

<p>L’outil développé permet de visualiser les différents évènements assez facilement à l’aide de ipywidget tout en naviguant les différentes parties, années et type de saisons. Sur une erreur de la visualisation, par exemple sur un début de partie ou n’importe quel évènement où les coordonnées ne sont pas disponibles, le texte en format json est montré à la place. L’outil balaye les fichiers locaux disponibles localement pour faire la liste des données à visualiser.</p>

<p><img src="/assets/Q2_no-event.png" alt="q2_no-event" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="n">widgets</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="n">mpimg</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="k">class</span> <span class="nc">event_visualizer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">img_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">rink_img</span> <span class="o">=</span> <span class="n">mpimg</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">initialize_values</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">create_widgets</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">initialize_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">season_type</span> <span class="o">=</span> <span class="s">'02'</span> <span class="c1"># init only
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">games_list</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_games_list</span><span class="p">()</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">year_list</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_year_list</span><span class="p">()</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">year</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">year_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># init only
</span>            <span class="bp">self</span><span class="p">.</span><span class="n">game_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_games_in_season</span><span class="p">()</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">game_id</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">game_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># init only
</span>            <span class="bp">self</span><span class="p">.</span><span class="nb">file</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">read_file</span><span class="p">()</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">events</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="nb">file</span><span class="p">[</span><span class="s">'playByPlay'</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">event_id</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># init only
</span>
    <span class="k">def</span> <span class="nf">create_widgets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">w_season_type</span> <span class="o">=</span> <span class="n">widgets</span><span class="p">.</span><span class="n">ToggleButtons</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="p">[(</span><span class="s">'Regular'</span><span class="p">,</span> <span class="s">'02'</span><span class="p">),</span> <span class="p">(</span><span class="s">'Playoff'</span><span class="p">,</span> <span class="s">'03'</span><span class="p">)],</span>
            <span class="n">description</span><span class="o">=</span><span class="s">'Season type'</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">w_season_year</span> <span class="o">=</span> <span class="n">widgets</span><span class="p">.</span><span class="n">ToggleButtons</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">year_list</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s">"Season year"</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">w_game_ids</span> <span class="o">=</span> <span class="n">widgets</span><span class="p">.</span><span class="n">SelectionSlider</span><span class="p">(</span>
            <span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">game_ids</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">game_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">description</span><span class="o">=</span><span class="s">"Game id"</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">w_season_year</span><span class="p">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">update</span><span class="p">,</span> <span class="s">'value'</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">w_season_type</span><span class="p">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">update</span><span class="p">,</span> <span class="s">'value'</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">w_game_ids</span><span class="p">.</span><span class="n">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">update</span><span class="p">,</span> <span class="s">'value'</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">widgets</span><span class="p">.</span><span class="n">GridspecLayout</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">w_season_type</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">w_season_year</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">grid</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">w_game_ids</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">season_type</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">w_season_type</span><span class="p">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">games_list</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_games_list</span><span class="p">()</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">year_list</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_year_list</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">w_season_year</span><span class="p">.</span><span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">year_list</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">year</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">w_season_year</span><span class="p">.</span><span class="n">value</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">game_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_games_in_season</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">w_game_ids</span><span class="p">.</span><span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">game_ids</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">game_id</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">w_game_ids</span><span class="p">.</span><span class="n">value</span>

        <span class="bp">self</span><span class="p">.</span><span class="nb">file</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">read_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">events</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="nb">file</span><span class="p">[</span><span class="s">'playByPlay'</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_games_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">games_list</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span> <span class="n">i</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="s">"_"</span> <span class="o">+</span> <span class="n">i</span><span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">games_list</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="p">.</span><span class="n">season_type</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_year_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">year_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span> <span class="p">[</span><span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"_"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">games_list</span><span class="p">]</span> <span class="p">))</span>
        <span class="n">year_list</span><span class="p">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">year_list</span>

    <span class="k">def</span> <span class="nf">get_games_in_season</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">season_games</span> <span class="o">=</span> <span class="p">[</span> <span class="n">i</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"_"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">games_list</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="p">.</span><span class="n">year</span> <span class="p">]</span>
        <span class="n">season_games</span><span class="p">.</span><span class="n">sort</span><span class="p">()</span> <span class="c1">#should be by default but still safer
</span>        <span class="k">return</span> <span class="n">season_games</span>

    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">path</span> <span class="o">+</span> <span class="s">"game_{year}{season}{id}.json"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">year</span><span class="p">,</span>
                                                                   <span class="n">season</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">season_type</span><span class="p">,</span>
                                                                   <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">game_id</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">plot_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_id</span><span class="p">):</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">events</span><span class="p">[</span><span class="n">event_id</span><span class="p">][</span><span class="s">'coordinates'</span><span class="p">][</span><span class="s">'x'</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">events</span><span class="p">[</span><span class="n">event_id</span><span class="p">][</span><span class="s">'coordinates'</span><span class="p">][</span><span class="s">'y'</span><span class="p">]</span>

            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">events</span><span class="p">[</span><span class="n">event_id</span><span class="p">][</span><span class="s">'result'</span><span class="p">][</span><span class="s">'description'</span><span class="p">]</span>
            <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">events</span><span class="p">[</span><span class="n">event_id</span><span class="p">][</span><span class="s">'about'</span><span class="p">][</span><span class="s">'periodTime'</span><span class="p">]</span>
            <span class="n">period</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">events</span><span class="p">[</span><span class="n">event_id</span><span class="p">][</span><span class="s">'about'</span><span class="p">][</span><span class="s">'period'</span><span class="p">]</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">rink_img</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mf">42.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">42.5</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">"feet"</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">42.5</span><span class="p">,</span> <span class="mf">42.5</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">"feet"</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">"{description}</span><span class="se">\n</span><span class="s">{time} P-{period}</span><span class="se">\n</span><span class="s">"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                                                                   <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                                                                   <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="s">'ok'</span><span class="p">)</span>

            <span class="n">plt</span><span class="p">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="nb">file</span><span class="p">[</span><span class="s">'home'</span><span class="p">])</span> <span class="c1"># positions for these are hard coded since they shouldn't change
</span>            <span class="n">plt</span><span class="p">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="nb">file</span><span class="p">[</span><span class="s">'away'</span><span class="p">])</span>

            <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">events</span><span class="p">[</span><span class="n">event_id</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="p">)</span>


<span class="n">game_viz</span> <span class="o">=</span> <span class="n">event_visualizer</span><span class="p">(</span><span class="s">"data/"</span><span class="p">,</span> <span class="s">"nhl_rink.png"</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">game_viz</span><span class="p">.</span><span class="n">grid</span><span class="p">)</span>

<span class="n">widgets</span><span class="p">.</span><span class="n">interact</span><span class="p">(</span><span class="n">game_viz</span><span class="p">.</span><span class="n">plot_event</span><span class="p">,</span> <span class="n">event_id</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">game_viz</span><span class="p">.</span><span class="n">events</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div></div>

<h2 id="section-4--nettoyer-les-données">Section 4 : Nettoyer les données</h2>

<h3 id="question-41">Question 4.1</h3>
<div class="message">
    Dans votre article de blog, incluez un petit extrait de votre dataframe final (par exemple, en utilisant head(10)). Vous pouvez simplement inclure une capture d'écran plutôt que de vous battre pour que les tableaux soient soigneusement formatés en HTML/markdown.
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/assets/Q4-1.png" alt="q4-1" /></p>

<!-- marche presque mais le site centre pas donc c'est pas beau
| event_id |  Season |    Phase | Period | PeriodTime | PlayID |                Team | RinkSide | XPoint | YPoint |           Shooter |             Goalie |   ShotType | EmptyNet | Event |  Situation | Distance |
|---------:|--------:|---------:|-------:|-----------:|-------:|--------------------:|---------:|-------:|-------:|------------------:|-------------------:|-----------:|---------:|------:|-----------:|---------:|
|   327332 | 2019-20 | Playoffs |      3 |      06:41 |    592 | Tampa Bay Lightning |     left |  -79.0 |   12.0 |      Alex Killorn |     Anton Khudobin |  Snap Shot |    False |  Goal |       Even |    168.0 |
|   327333 | 2019-20 | Playoffs |      3 |      11:35 |    712 |        Dallas Stars |    right |   82.0 |   -8.0 |      Joe Pavelski | Andrei Vasilevskiy |  Deflected |    False |  Goal |       Even |    171.0 |
|   327334 | 2019-20 | Playoffs |      4 |      06:34 |    901 | Tampa Bay Lightning |    right |   67.0 |  -24.0 | Kevin Shattenkirk |     Anton Khudobin |  Snap Shot |    False |  Goal | Power Play |    157.0 |
|   327335 | 2019-20 | Playoffs |      1 |      17:52 |     90 |        Dallas Stars |    right |   74.0 |   -2.0 |       Corey Perry | Andrei Vasilevskiy | Wrist Shot |    False |  Goal |       Even |    163.0 |
|   327336 | 2019-20 | Playoffs |      2 |      04:37 |    263 | Tampa Bay Lightning |    right |   83.0 |    4.0 |      Ondrej Palat |     Anton Khudobin | Wrist Shot |    False |  Goal |       Even |    172.0 |
|   327337 | 2019-20 | Playoffs |      3 |      03:38 |    568 | Tampa Bay Lightning |     left |  -34.0 |  -20.0 | Mikhail Sergachev |     Anton Khudobin |  Slap Shot |    False |  Goal |       Even |    124.0 |
|   327338 | 2019-20 | Playoffs |      3 |      13:15 |    595 |        Dallas Stars |    right |   83.0 |    4.0 |      Joe Pavelski | Andrei Vasilevskiy | Wrist Shot |    False |  Goal |       Even |    172.0 |
|   327339 | 2019-20 | Playoffs |      5 |      09:23 |   1094 |        Dallas Stars |    right |   80.0 |    2.0 |       Corey Perry | Andrei Vasilevskiy | Wrist Shot |    False |  Goal |       Even |    169.0 |
|   327340 | 2019-20 | Playoffs |      1 |      12:23 |     75 | Tampa Bay Lightning |     left |  -80.0 |    0.0 |     Brayden Point |     Anton Khudobin | Wrist Shot |    False |  Goal | Power Play |    169.0 |
|   327341 | 2019-20 | Playoffs |      2 |      07:01 |    366 | Tampa Bay Lightning |    right |   64.0 |  -12.0 |     Blake Coleman |     Anton Khudobin |  Slap Shot |    False |  Goal |       Even |    153.0 | -->

<h3 id="question-42">Question 4.2</h3>
<div class="message">
    Vous remarquerez que le champ de « force » (c.-à-d. égal, avantage numérique ou en désavantage numérique) n'existe que pour les buts, pas pour les tirs. De plus, il n'inclut pas la force réelle des joueurs sur la glace (c'est-à-dire 5 contre 4, ou 5 contre 3, etc.). Discutez de la façon dont vous pourriez ajouter les informations sur la force réelle (c'est-à-dire 5 contre 4, etc.) aux tirs et aux buts, compte tenu des autres types d'événements (autre que ces derniers) et des autres données disponibles. Vous n'avez pas besoin d’implémenter cette fonctionnalité pour ce milestone.
</div>

<p>Dans un match de hockey, chaque action sur la glace a son importance, qu’il s’agisse d’un tir, d’un but ou même d’une pénalité. Lorsque nous examinons les statistiques, nous pouvons souvent voir le nombre de tirs ou de buts, mais une dimension souvent négligée est la “force réelle” lors de ces actions. La force réelle se réfère à la situation numérique sur la glace, comme 5 contre 4 lors d’une pénalité ou 5 contre 5 en jeu égal.</p>

<p>Pour déterminer cette force réelle, il est essentiel d’intégrer les données des événements de pénalité dans notre DataFrame. Chaque pénalité indique la durée pendant laquelle une équipe jouera en infériorité numérique. En suivant ces pénalités et en les associant aux tirs et aux buts qui se produisent pendant leur durée, nous pouvons déduire la force réelle de chaque attaque. Par exemple, si une pénalité de deux minutes est infligée à 10:00 et qu’un tir est enregistré à 10:30, on peut conclure que ce tir a eu lieu en avantage numérique.</p>

<p>Mais attention, d’autres événements peuvent influencer la situation. Un but marqué pendant un avantage numérique pourrait annuler la pénalité, ou des pénalités simultanées pourraient maintenir un jeu à 5 contre 5. Il est donc crucial de prendre en compte tous les événements du jeu.</p>

<h3 id="question-43">Question 4.3</h3>
<div class="message">
    En quelques phrases, discutez d’au moins 3 caractéristiques supplémentaires que vous pourriez envisager de créer à partir des données disponibles dans cet ensemble de données. Nous ne cherchons pas de réponses particulières, mais si vous avez besoin d'inspiration, un tir ou un but pourrait-il être classé comme un rebond/tir en contre-attaque (expliquez comment identifier ceux-ci)?
</div>

<h4 id="efficacité-des-joueurs">Efficacité des Joueurs</h4>
<p>En utilisant les données sur les joueurs qui tirent, on pourrait créer une métrique pour évaluer l’efficacité des tirs de chaque joueur. Cela consisterait à calculer le pourcentage de tirs d’un joueur qui se transforment en buts. Cette métrique pourrait aider à identifier les joueurs les plus dangereux ou les plus efficaces en face du but.</p>

<h4 id="efficacité-du-gardien-de-but">Efficacité du Gardien de but</h4>
<p>En se basant sur le nombre de tirs qu’un gardien de but reçoit et le nombre de buts qu’il concède, on pourrait calculer un taux d’arrêt pour chaque gardien. Cela donnerait une mesure directe de l’efficacité d’un gardien à stopper les tirs adverses.</p>

<h4 id="tirs-en-contre-attaque---rebonds">Tirs en Contre-Attaque - Rebonds</h4>
<p>Pour identifier un tir en contre-attaque, on pourrait examiner la séquence des événements. Si un “Hit” ou un “Turnover” est suivi rapidement par un tir de l’équipe opposée, cela pourrait indiquer un tir en contre-attaque. Si un tir est suivi immédiatement par un autre tir de la même équipe sans qu’un événement significatif se produise entre les deux (comme un dégagement ou un arrêt de jeu), le second tir pourrait être considéré comme un rebond.</p>

<h2 id="section-5--visualisations-simples">Section 5 : Visualisations simples</h2>

<h3 id="question-51">Question 5.1</h3>
<div class="message">
    Produisez un graphique comparant les types de tirs de toutes les équipes dans une saison de votre choix (i.e. agrégez juste sur tous les tirs). Superposez le nombre de buts sur le nombre de tirs. Quel semble être le type de tir le plus dangereux? Le type de tir le plus courant? Pourquoi est-ce que vous avez choisi ce type de graphique? Ajoutez ce graphique et cette discussion à votre article de blog.
</div>

<p><img src="/assets/Q5-1.png" alt="q5-1" /></p>

<p>Le graphique ci-dessus présente une comparaison des différents types de tirs par rapport aux buts marqués pour chaque type lors de la saison 2019-20.</p>

<h4 id="type-de-tir-le-plus-courant">Type de tir le plus courant</h4>
<p>On peut constater que “Wrist Shot” est clairement le type de tir le plus fréquemment utilisé par les équipes.</p>

<h4 id="type-de-tir-le-plus-dangereux">Type de tir le plus dangereux</h4>
<p>En observant la proportion de buts par rapport au nombre total de tirs, le “Tip-In” semble être le plus efficace pour marquer des buts. Cependant, le “Wrist Shot”, en raison de sa fréquence élevée, a également produit un grand nombre de buts.</p>

<h4 id="pourquoi-ce-type-de-graphique">Pourquoi ce type de graphique</h4>
<p>On a choisi un graphique à barres empilées car il permet de comparer directement le nombre total de tirs et le nombre de buts pour chaque type de tir. Les couleurs Rouges et Vertes permettent de distinguer les buts des tirs.</p>

<h3 id="question-52">Question 5.2</h3>
<div class="message">
    Quelle est la relation entre la distance à laquelle un tir a été effectué et la chance qu'il s'agisse d'un but? Produisez un graphique pour chaque saison entre 2018-19 et 2020-21 pour répondre à cette question, et ajoutez-le à votre article de blog avec quelques phrases décrivant le graphique. Y a-t-il eu beaucoup de changements au cours des trois dernières saisons? Pourquoi est-ce que vous avez choisi ce type de graphique?
        a.	Trouver la distance du tir nécessite la combinaison de plusieurs des données, c’est à vous de trouver une méthode qui fonctionne pour la majorité des parties (certaines ont des informations manquantes).
        b.	Si vous notez quelques données aberrantes, ne vous inquiétez pas, on en reparlera dans le milestone 2.

</div>

<p>Comprendre la relation entre la distance du tir et la probabilité de marquer est crucial pour les équipes et les entraîneurs. Cette connaissance peut influencer les stratégies offensives des équipes par exemple. Il est donc toujours utile de visualiser ces relations. Les graphiques ci-dessous montrent la probabilité de marquer un but en fonction de la distance du tir pour les saisons 2018-19, 2019-20 et 2020-21.</p>

<p><img src="/assets/Q5-2_2018.png" alt="q5-2_2018" />
<img src="/assets/Q5-2_2019.png" alt="q5-2_2019" />
<img src="/assets/Q5-2_2020.png" alt="q5-2_2020" /></p>

<h4 id="observations">Observations</h4>
<p>Au cours des saisons 2018 et 2019, les données montrent clairement que les tirs à une distance plus courte ont une probabilité significativement plus élevée de se transformer en buts. Cependant, la saison 2020-21 présente une tendance différente, avec des probabilités de marquer qui ne sont pas aussi élevées, même pour les tirs à courte distance. Cette différence est attribuée au nombre de matches joués cette saison en raison de la pandémie de COVID-19
À mesure que la distance augmente, la probabilité de marquer diminue. Cependant, il y a certaines distances où il y a des pics ou des augmentations notables de la probabilité. Cela pourrait être dû à des tirs précis, comme les « Slap shots », qui sont puissants et peuvent surprendre le gardien.
Il y a une certaine cohérence dans la tendance à travers les trois saisons, bien que de légères variations puissent être observées.</p>

<h4 id="pourquoi-ce-type-de-graphique-1">Pourquoi ce type de graphique</h4>
<p>On a choisi un graphique linéaire car il permet de voir clairement comment une variable (dans ce cas, la probabilité de marquer) change en fonction d’une autre variable continue (dans ce cas, la distance du tir). Les graphiques linéaires sont un excellent choix pour notre situation puisqu’ils captent les pics et les creux.</p>

<h3 id="question-53">Question 5.3</h3>
<div class="message">
    Combinez les informations des sections précédentes pour produire un graphique qui montre le pourcentage de buts (# buts / # tirs) en fonction à la fois de la distance par rapport au filet et de la catégorie de types de tirs (vous pouvez choisir une seule saison de votre choix). Discutez brièvement de vos conclusions. Par exemple, quels sont les types de tirs les plus dangereux?
</div>

<p><img src="/assets/Q5-3.png" alt="q5-3" /></p>

<h4 id="tirs-rapprochés">Tirs rapprochés</h4>
<p>Comme attendu, il y a une concentration plus élevée (zones plus claires) de buts pour les tirs effectués à courte distance, en particulier pour les “Tip-Ins” et les “Snap Shots”. Cela renforce l’idée que les tirs rapprochés ont généralement une probabilité plus élevée de se transformer en des buts.</p>

<h4 id="efficacité-des-tip-ins">Efficacité des “Tip-Ins”</h4>
<p>Les “Tip-Ins”, semblent être particulièrement efficaces à courte distance. Cela pourrait être dû à la nature imprévisible de ces tirs, rendant difficile pour le gardien de but de les arrêter.</p>

<h4 id="variabilité-avec-la-distance">Variabilité avec la distance</h4>
<p>Pour les tirs tels que les “Slap Shots” et les “Wrist Shots”, il y a une variabilité notable dans le pourcentage de buts à mesure que la distance augmente. Bien que ces tirs soient généralement moins efficaces à longue distance, il y a des zones où ils ont un taux de réussite relativement élevé, peut-être en raison de la puissance ou de la précision du tir.</p>

<h4 id="zones-plus-foncées-à-longue-distance">Zones plus foncées à longue distance</h4>
<p>Comme prévu, la plupart des types de tirs ont un pourcentage de buts plus faible lorsqu’ils sont pris à longue distance. Cela est logique car il est généralement plus difficile de marquer depuis une distance éloignée. Sauf que pour quelques cas, on peut remarquer des grands pourcentages et c’est a cause du nombre limités des tirs effectués à ces distances durant cette saison.</p>

<h2 id="section-6--visualisations-avancées">Section 6 : Visualisations avancées</h2>

<h3 id="question-61">Question 6.1</h3>
<div class="message">
    Exportez les 4 graphiques de zone offensive au format HTML et intégrez-les dans votre article de blog. Votre graphique doit permettre aux utilisateurs de sélectionner n'importe quelle équipe pour la saison sélectionnée.
    Note: Parce que vous pouvez trouver ces graphiques sur l’internet, répondre à ces questions sans produire ces graphiques ne vous rapportera pas de points !
</div>

<p>…content…</p>

<h3 id="question-62">Question 6.2</h3>
<div class="message">
    Discutez (en quelques phrases) de ce que vous pouvez interpréter à partir de ces graphiques.
</div>

<p>…content…</p>

<h3 id="question-63">Question 6.3</h3>
<div class="message">
    Considérez l'Avalanche du Colorado; jetez un œil à leur carte de tir au cours de la saison 2016-17. Discutez de ce que vous pourriez dire sur l'équipe au cours de cette saison. Regardez maintenant la carte de tirs de l'Avalanche du Colorado pour la saison 2020-21 et discutez de ce que vous pouvez conclure de ces différences. Est-ce que ça a du sens? Astuce : regardez le classement.
</div>

<p>…content…</p>

<h3 id="question-64">Question 6.4</h3>
<div class="message">
    Considérez les Sabres de Buffalo, une équipe qui a connu des difficultés ces dernières années, et comparez-les au Lightning de Tampa Bay, une équipe qui a remporté la coupe Stanley pour deux années consécutives. Regardez les plans de tir de ces deux équipes des saisons 2018-19, 2019-20 et 2020-21. Discutez des observations que vous pouvez faire. Y a-t-il quelque chose qui pourrait expliquer le succès du Lightning, ou les problème des Sabres ? Est-ce que ces images sont suffisantes pour tout comprendre les succès ou problèmes d’une équipe?
</div>

<p>…content…</p>

  </div>
  
</div>

<div class="pagination">
  
    <span class="pagination-item older">Older</span>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
